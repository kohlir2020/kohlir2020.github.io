<nav class="site-nav" role="navigation" aria-label="Main navigation">
  <div class="nav-container">
    <a href="{{ '/' | relative_url }}" class="nav-logo" aria-label="Home - {{ site.title | default: 'Raunit Kohli' }}">
      {{ site.title | default: "Raunit Kohli" }}
    </a>
    
    <button class="nav-toggle" 
            type="button" 
            aria-label="Toggle navigation menu" 
            aria-expanded="false"
            aria-controls="nav-menu">
      <span class="nav-toggle-icon" aria-hidden="true">
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
      </span>
      <span class="nav-toggle-text sr-only">Menu</span>
    </button>
    
    <ul class="nav-menu" id="nav-menu" role="menubar" aria-labelledby="nav-toggle">
      <li role="none">
        <a href="{{ '/' | relative_url }}" role="menuitem" 
           class="nav-link{% if page.url == '/' %} nav-link--active{% endif %}"
           aria-current="{% if page.url == '/' %}page{% else %}false{% endif %}"
           tabindex="0">
          Home
        </a>
      </li>
      <li role="none">
        <a href="{{ '/projects/' | relative_url }}" role="menuitem"
           class="nav-link{% if page.url contains '/projects' %} nav-link--active{% endif %}"
           aria-current="{% if page.url contains '/projects' %}page{% else %}false{% endif %}"
           tabindex="0">
          Projects
        </a>
      </li>
      <li role="none">
        <a href="{{ '/publications/' | relative_url }}" role="menuitem"
           class="nav-link{% if page.url contains '/publications' %} nav-link--active{% endif %}"
           aria-current="{% if page.url contains '/publications' %}page{% else %}false{% endif %}"
           tabindex="0">
          Publications
        </a>
      </li>
      <li role="none">
        <a href="{{ '/about/' | relative_url }}" role="menuitem"
           class="nav-link{% if page.url == '/about/' %} nav-link--active{% endif %}"
           aria-current="{% if page.url == '/about/' %}page{% else %}false{% endif %}"
           tabindex="0">
          About
        </a>
      </li>
      <li role="none">
        <a href="{{ '/cv/' | relative_url }}" role="menuitem"
           class="nav-link{% if page.url == '/cv/' %} nav-link--active{% endif %}"
           aria-current="{% if page.url == '/cv/' %}page{% else %}false{% endif %}"
           tabindex="0">
          CV
        </a>
      </li>
      <li role="none">
        <a href="{{ '/contact/' | relative_url }}" role="menuitem"
           class="nav-link{% if page.url == '/contact/' %} nav-link--active{% endif %}"
           aria-current="{% if page.url == '/contact/' %}page{% else %}false{% endif %}"
           tabindex="0">
          Contact
        </a>
      </li>
    </ul>
  </div>
</nav>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const navToggle = document.querySelector('.nav-toggle');
  const navMenu = document.querySelector('.nav-menu');
  const navLinks = navMenu.querySelectorAll('.nav-link');
  
  let isMenuOpen = false;

  // Toggle menu function
  function toggleMenu() {
    isMenuOpen = !isMenuOpen;
    navToggle.setAttribute('aria-expanded', isMenuOpen);
    navMenu.classList.toggle('nav-menu--open', isMenuOpen);
    
    // Manage focus
    if (isMenuOpen) {
      // Focus first menu item when opened
      navLinks[0].focus();
      // Trap focus within menu
      trapFocus();
    } else {
      // Return focus to toggle button when closed
      navToggle.focus();
    }
  }

  // Focus trap function
  function trapFocus() {
    const focusableElements = navMenu.querySelectorAll('a[href], button:not([disabled])');
    const firstFocusable = focusableElements[0];
    const lastFocusable = focusableElements[focusableElements.length - 1];

    navMenu.addEventListener('keydown', function(e) {
      if (!isMenuOpen) return;

      if (e.key === 'Tab') {
        if (e.shiftKey) {
          // Shift + Tab (backward)
          if (document.activeElement === firstFocusable) {
            e.preventDefault();
            lastFocusable.focus();
          }
        } else {
          // Tab (forward)
          if (document.activeElement === lastFocusable) {
            e.preventDefault();
            firstFocusable.focus();
          }
        }
      }
    });
  }

  // Toggle menu on button click
  navToggle.addEventListener('click', toggleMenu);

  // Close menu on Escape key
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape' && isMenuOpen) {
      toggleMenu();
    }
  });

  // Close menu when clicking outside (mobile)
  document.addEventListener('click', function(e) {
    if (isMenuOpen && 
        !navMenu.contains(e.target) && 
        !navToggle.contains(e.target)) {
      toggleMenu();
    }
  });

  // Close menu when a nav link is clicked (mobile)
  navLinks.forEach(link => {
    link.addEventListener('click', function() {
      if (isMenuOpen && window.innerWidth < 768) {
        toggleMenu();
      }
    });
  });

  // Handle window resize
  window.addEventListener('resize', function() {
    if (window.innerWidth >= 768 && isMenuOpen) {
      // Reset menu state on desktop
      isMenuOpen = false;
      navToggle.setAttribute('aria-expanded', false);
      navMenu.classList.remove('nav-menu--open');
    }
  });
});
</script>